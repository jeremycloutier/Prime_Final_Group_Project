var app=angular.module("myApp",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"views/pieChart.html",controller:"pieChartController"}).when("/lineGraph",{templateUrl:"views/lineGraph.html",controller:"lineGraphController"}),b.html5Mode(!0)}]),app.controller("MainController",["$scope","$location","SmartSheetService",function(a,b,c){function d(a,b,c,d){var e={},f=Date.parse(a.classStart);if(isNaN(f)||isNaN(b)||isNaN(c))return null;if(f>c||b>f)return null;var g=0,h=0,i=Date.parse(a.employHistory.start),j=Date.parse(a.employHistory.end);i&&!isNaN(i)&&(h=((new Date-i)/1e3/3600/24).toFixed(0),g=j&&!isNaN(j)?(j-i)/1e3/3600/24:-1);for(var k=Object.keys(d),l=0;l<k.length&&!(h<d[k[l]]);l++)0>g||g>=d[k[l]]?e[k[l]]=!0:e[k[l]]=!1;return e}function e(a,b,c){for(var e={"3mo":90,"6mo":180,"1yr":365,"2yr":730,"3yr":1095,"4yr":1460,"5yr":1825},f=Object.keys(e),g={},h=0;h<f.length;h++)g[f[h]]={number:null,percent:null};var i=0,j={},k={};for(h=0;h<a.length;h++)if(j=d(a[h],b,c,e),j&&(k=Object.keys(j),k.length>0)){i++;for(var l=0;l<k.length;l++)g[k[l]].number++}for(h=0;h<f.length;h++)g[f[h]].percent=(g[f[h]].number/i*100).toFixed(1);return g}function f(a,b,c){for(var d=0,e=0,f=0,h=0;h<a.length;h++)f=g(a[h],b,c),f&&(d+=f,e++);return(d/e).toFixed(2)}function g(a,b,c){var d=Date.parse(a.classStart);return isNaN(d)||isNaN(b)||isNaN(c)?null:a.employHistory.start&&d>=b&&c>=d&&a.wages.length>0?a.wages[0]:null}function h(a,b,c){for(var d=0,e=0,f=0,g=0;g<a.length;g++)f=i(a[g],b,c),f&&(d+=f,e++);return(d/e).toFixed(2)}function i(a,b,c){var d=Date.parse(a.classStart);return isNaN(d)||isNaN(b)||isNaN(c)?null:a.employHistory.start&&!a.employHistory.end&&d>=b&&c>=d&&a.wages.length>0?a.wages[a.wages.length-1]:null}function j(a,b,c,d){var e=0,f=0,g=0;if(isNaN(c)||isNaN(d))return null;for(var h=0;h<b.length;h++){var j=Date.parse(b[h].classStart);if(!isNaN(j)&&j>=c&&d>=j)for(var k=0;k<a.length;k++){var l=a[k];if(!b[h][l])break;k==a.length-1&&(f=i(b[h],c,d),f&&(e+=f,g++))}}console.log("count",g),console.log("sum of wages",e);var m=(e/g).toFixed(2);console.log(m)}function k(b,c,d){if(isNaN(c)||isNaN(d))return null;var e={};a.topFive=[];for(var f=0;f<b.length;f++){var g=Date.parse(b[f].classStart);if(!isNaN(g)&&g>=c&&d>=g)for(var h=0;h<b[f].distinctEmployers.length;h++){var i=b[f].distinctEmployers[h];e.hasOwnProperty(i)||(e[i]=0),e[i]++}}a.sortedEmployers=m(e);for(var j=0;5>j;j++)a.topFive.push(a.sortedEmployers.pop());return a.topFive}function l(b,c){var d=c;return b&&(d.number++,d.percent=Number(Math.round(d.number/a.numServed*100+"e2")+"e-2")),d}function m(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push({key:b,value:a[b]});return c.sort(function(a,b){return a.value-b.value}),c}a.endDate=new Date,a.startDate=new Date("2012-05-08"),a.smartSheetData=[],c.getSmartSheetData().then(function(b){a.smartSheetData=b.data,a.submitDate()}),a.submitDate=function(){a.numServed=0,a.completed={number:0,percent:0},a.certified={number:0,percent:0},a.placed={number:0,percent:0},a.certNetwork={number:0,percent:0},a.certServer={number:0,percent:0},a.certSecurity={number:0,percent:0};for(var b=0;b<a.smartSheetData.length;b++){var c=new Date(a.smartSheetData[b].classStart),d=c.setDate(c.getDate()+1);d>=a.startDate&&d<=a.endDate&&(a.numServed++,a.completed=l(a.smartSheetData[b].gradDate,a.completed),a.certified=l(a.smartSheetData[b].certDate,a.certified),a.placed=l(a.smartSheetData[b].employHistory.start,a.placed),a.certNetwork=l(a.smartSheetData[b].networkPlus,a.certNetwork),a.certServer=l(a.smartSheetData[b].serverPlus,a.certServer),a.certSecurity=l(a.smartSheetData[b].securityPlus,a.certSecurity))}var g=new Date(a.startDate);g.setDate(g.getDate()-1),a.avgWageAtPlacement=f(a.smartSheetData,g,Date.parse(a.endDate)),a.avgCurrentWage=h(a.smartSheetData,g,Date.parse(a.endDate)),a.getTopFive=k(a.smartSheetData,g,Date.parse(a.endDate)),a.retentionData=e(a.smartSheetData,g,Date.parse(a.endDate))},a.certAplus=!1,a.certNetworkplus=!1,a.certSecurityplus=!1,a.certServerplus=!1,a.otherCert=!1,a.calcAvgSalary=function(){a.tempCertArray=[],a.certDate&&a.tempCertArray.push("certDate"),a.networkPlus&&a.tempCertArray.push("networkPlus"),a.serverPlus&&a.tempCertArray.push("serverPlus"),a.securityPlus&&a.tempCertArray.push("securityPlus"),a.otherCert&&a.tempCertArray.push("otherCert");var b=new Date(a.startDate);b.setDate(b.getDate()-1),j(a.tempCertArray,a.smartSheetData,b,Date.parse(a.endDate))},function(a){"use strict";var b=[{label:"White",count:15},{label:"Black",count:10},{label:"Latino",count:5},{label:"Asian",count:8}],c=360,d=360,e=Math.min(c,d)/2,f=a.scale.ordinal().range(["pink","blue","yellow","green"]),g=a.select("#chart").append("svg").attr("width",c).attr("height",d).append("g").attr("transform","translate("+c/2+","+d/2+")"),h=a.svg.arc().outerRadius(e),i=a.layout.pie().value(function(a){return a.count}).sort(null);g.selectAll("path").data(i(b)).enter().append("path").attr("d",h).attr("fill",function(a,b){return f(a.data.label)})}(window.d3),a.demographicList=["Age","Gender","Race","Veteran Status"],a.progressList=["Served","Completed","Certified A+","Placed"],a.tab="a",a.chartTab="pie",a.averageShow=!1,a.generateCharts=function(a,b){console.log("demographics, progress",a,b)},a.showAverageSalary=function(){a.averageShow=!0},a.hideAverageSalary=function(){a.averageShow=!1}}]),app.controller("pieChartController",["$scope","$location",function(a,b){a.pie="this pie chart view is controlled",function(a){"use strict";var b=[{label:"White",count:15},{label:"Black",count:10},{label:"Latino",count:5},{label:"Asian",count:8}],c=360,d=360,e=Math.min(c,d)/2,f=a.scale.ordinal().range(["pink","blue","yellow","green"]),g=a.select("#chart").append("svg").attr("width",c).attr("height",d).append("g").attr("transform","translate("+c/2+","+d/2+")"),h=a.svg.arc().outerRadius(e),i=a.layout.pie().value(function(a){return a.count}).sort(null);g.selectAll("path").data(i(b)).enter().append("path").attr("d",h).attr("fill",function(a,b){return f(a.data.label)})}(window.d3)}]),app.controller("lineGraphController",["$scope","$location",function(a,b){a.line="this line Graph view is controlled"}]),app.factory("SmartSheetService",["$http",function(a){var b=function(){return a.get("/api")};return{getSmartSheetData:b}}]);